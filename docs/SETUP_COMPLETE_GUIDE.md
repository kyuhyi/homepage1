# 🚀 구글 시트 연동 완벽 가이드

**시트 ID**: `1YMRIXQpEcMK2gQb5zU6XnDKLrHbbW7vKZ0iOe_V8Ozc`

이 가이드를 따라하시면 5분 안에 랜딩페이지와 구글 시트를 완벽하게 연동할 수 있습니다!

---

## 📋 1단계: 구글 시트 열기

1. 다음 링크로 구글 시트에 접속하세요:
   ```
   https://docs.google.com/spreadsheets/d/1YMRIXQpEcMK2gQb5zU6XnDKLrHbbW7vKZ0iOe_V8Ozc/edit
   ```

2. 본인의 구글 계정으로 로그인되어 있는지 확인
3. 시트 이름을 "AI 바이브코딩 신청자"로 변경 (선택사항)

---

## ⚙️ 2단계: Apps Script 설정

### 2-1. Apps Script 편집기 열기

1. 구글 시트 상단 메뉴에서 **확장 프로그램** 클릭
2. **Apps Script** 선택
3. 새 탭에서 Apps Script 편집기가 열립니다

### 2-2. 코드 복사 & 붙여넣기

1. 기본으로 있는 `Code.gs` 파일의 **모든 내용을 삭제**
2. 아래 파일의 코드를 **전체 복사**:
   ```
   docs/google-apps-script.js
   ```
3. Apps Script 편집기에 **붙여넣기**
4. **Ctrl+S (Mac: Cmd+S)**로 저장

### 2-3. 시트 ID 확인 (이미 설정됨)

코드 4번째 줄을 확인하세요:
```javascript
const SPREADSHEET_ID = '1YMRIXQpEcMK2gQb5zU6XnDKLrHbbW7vKZ0iOe_V8Ozc';
```

이 ID가 여러분의 시트 ID와 일치하는지 확인! ✅

---

## 🚀 3단계: 웹 앱 배포

### 3-1. 배포 시작

1. Apps Script 편집기 상단 오른쪽의 **배포** 버튼 클릭
2. **새 배포** 선택

### 3-2. 배포 설정

**유형 선택**:
- 톱니바퀴 아이콘 ⚙️ 클릭
- **웹 앱** 선택

**설정 입력**:
- **설명**: `AI 바이브코딩 랜딩페이지 API v1.0`
- **다음 사용자로 실행**: **나** 선택
- **액세스 권한**: **모든 사용자** 선택 ⚠️ (중요!)

### 3-3. 배포 실행

1. **배포** 버튼 클릭
2. **액세스 승인** 창이 뜨면:
   - 본인 구글 계정 선택
   - "이 앱은 Google에서 확인하지 않았습니다" 경고가 나오면:
     - **고급** 클릭
     - **[프로젝트명](안전하지 않은 페이지)로 이동** 클릭
   - **허용** 버튼 클릭

3. **웹 앱 URL 복사** 📋
   ```
   예시: https://script.google.com/macros/s/AKfycby...xyz/exec
   ```
   → 이 URL을 안전한 곳에 복사해두세요!

---

## 🔧 4단계: Next.js 프로젝트 환경 변수 설정

### 4-1. .env.local 파일 열기

프로젝트 루트 폴더의 `.env.local` 파일을 엽니다.

### 4-2. URL 붙여넣기

복사한 웹 앱 URL을 다음과 같이 붙여넣습니다:

```env
# Google Apps Script Web App URL
NEXT_PUBLIC_GOOGLE_SCRIPT_URL=https://script.google.com/macros/s/YOUR_DEPLOYMENT_ID/exec

# Google Analytics ID (선택사항)
NEXT_PUBLIC_GA_ID=
```

**⚠️ 중요**:
- `YOUR_DEPLOYMENT_ID` 부분을 실제 복사한 URL로 완전히 교체
- URL 앞뒤에 공백이나 따옴표 없이 깔끔하게 붙여넣기

### 4-3. 개발 서버 재시작

터미널에서:
```bash
# 기존 서버 종료 (Ctrl+C)
# 캐시 삭제 후 재시작
cd ai-vibecoding-landing
rm -rf .next
npm run dev
```

---

## ✅ 5단계: 테스트

### 5-1. 랜딩페이지 열기

브라우저에서 접속:
```
http://localhost:3000
```

### 5-2. 테스트 신청

1. 페이지를 스크롤하여 **신청 폼** 섹션으로 이동
2. 테스트 데이터 입력:
   - **이메일**: `test@example.com`
   - **카카오톡 ID**: `testuser123`
3. **무료 특강 신청하기** 버튼 클릭

### 5-3. 구글 시트 확인

1. 구글 시트로 돌아가기
2. **"신청자"** 시트 탭 확인 (자동 생성됨)
3. 방금 입력한 데이터가 표시되는지 확인:
   - 신청일시
   - 이메일
   - 카카오톡 ID
   - IP 주소
   - User Agent
   - 상태

**✨ 성공!** 데이터가 보이면 연동 완료!

---

## 🎯 시트 구조 설명

자동으로 생성되는 시트 구조:

| 신청일시 | 이메일 | 카카오톡 ID | IP 주소 | User Agent | 상태 |
|---------|--------|------------|---------|-----------|------|
| 2025-01-15 14:30:25 | test@example.com | testuser123 | 192.168.1.1 | Mozilla/5.0... | 신규 |

**헤더 색상**: 보라색 (#6B46C1) 배경에 흰색 텍스트

---

## 🔒 보안 기능

✅ **이메일 중복 방지**: 같은 이메일로 재신청 불가
✅ **이메일 형식 검증**: 올바른 이메일 형식만 허용
✅ **필수 필드 검증**: 이메일과 카카오톡 ID 필수 입력
✅ **타임스탬프 자동 기록**: 신청 일시 자동 저장
✅ **IP 주소 추적**: 신청자 IP 기록 (어뷰징 방지)

---

## 📧 선택 기능: 신청 확인 이메일

코드에 이미 포함된 기능입니다!

신청자에게 자동으로 확인 이메일이 발송됩니다:

```
제목: [AI 바이브코딩] 무료 특강 신청이 완료되었습니다

내용:
안녕하세요!

AI 바이브코딩 무료 비밀특강 신청이 완료되었습니다.

📧 신청 이메일: test@example.com
💬 카카오톡 ID: testuser123

특강 일정 및 상세 안내는 등록하신 카카오톡으로 발송될 예정입니다.

감사합니다.
```

**이메일 비활성화 방법**:
- `sendConfirmationEmail` 함수 호출 부분을 주석 처리

---

## 🛠️ 문제 해결

### ❌ "신청이 완료되지 않았습니다" 에러

**원인**: 웹 앱 URL이 잘못 설정됨

**해결**:
1. `.env.local` 파일 확인
2. `NEXT_PUBLIC_GOOGLE_SCRIPT_URL` 값이 정확한지 확인
3. URL 앞뒤 공백 제거
4. 개발 서버 재시작

### ❌ CORS 에러

**원인**: Apps Script 배포 설정 문제

**해결**:
1. Apps Script 편집기 → **배포** → **배포 관리**
2. 현재 배포 확인
3. **액세스 권한**이 "모든 사용자"인지 확인
4. 아니면 새 배포 생성

### ❌ "이미 신청하신 이메일입니다"

**정상 동작**: 중복 신청 방지 기능

**테스트 계속하려면**:
1. 구글 시트에서 해당 이메일 행 삭제
2. 또는 다른 이메일로 테스트

### ❌ 데이터가 시트에 나타나지 않음

**해결 단계**:

1. **Apps Script 로그 확인**:
   - Apps Script 편집기 → **실행** → `doGet` 함수 선택
   - **실행** 버튼 클릭
   - 로그에서 에러 메시지 확인

2. **시트 ID 확인**:
   ```javascript
   const SPREADSHEET_ID = '1YMRIXQpEcMK2gQb5zU6XnDKLrHbbW7vKZ0iOe_V8Ozc';
   ```
   이 값이 정확한지 재확인

3. **권한 재승인**:
   - Apps Script → **실행** → `doPost` 테스트 함수 실행
   - 권한 재승인

---

## 📊 관리자 기능

### 신청자 통계 보기

Apps Script 편집기에서:
1. 함수 선택: `getApplicationStats`
2. **실행** 버튼 클릭
3. **로그** 창에서 통계 확인:
   - 총 신청자 수
   - 오늘 신청자 수
   - 이번 주 신청자 수

### 시트 데이터 초기화 (⚠️ 주의)

Apps Script 편집기에서:
1. 함수 선택: `resetSheet`
2. **실행** 버튼 클릭
3. 확인 대화상자에서 **예** 선택

**⚠️ 경고**: 모든 신청 데이터가 삭제됩니다!

---

## 🔄 배포 업데이트

코드를 수정한 후:

1. Apps Script 편집기에서 **Ctrl+S** (저장)
2. **배포** → **배포 관리**
3. 현재 배포의 ✏️ 아이콘 클릭
4. **버전** → **새 버전**
5. **배포** 클릭

**중요**: URL은 변경되지 않으므로 `.env.local` 수정 불필요!

---

## 📱 실전 운영 팁

### 1. 신청자 알림 받기

`sendConfirmationEmail` 함수를 수정하여 본인에게도 알림:

```javascript
// 관리자에게도 알림 보내기
MailApp.sendEmail({
  to: 'your-email@gmail.com',
  subject: '🎉 새 신청: ' + email,
  body: `신청자: ${email} (${kakaoId})`
});
```

### 2. 신청 데이터 엑셀 다운로드

구글 시트에서:
1. **파일** → **다운로드**
2. **Microsoft Excel (.xlsx)** 선택

### 3. 자동 백업 설정

구글 시트:
1. **파일** → **버전 기록** → **이름이 지정된 버전 저장**
2. 정기적으로 백업 생성

---

## 🎓 다음 단계

✅ **구글 시트 연동 완료!**

이제 다음을 진행하세요:

1. **Vercel 배포**: 실제 도메인에 배포
2. **Google Analytics 설정**: 방문자 추적
3. **도메인 연결**: 커스텀 도메인 설정
4. **카카오톡 알림**: 신청자에게 카카오 메시지 전송

---

## 📞 도움이 필요하신가요?

문제가 해결되지 않으면:

1. **Apps Script 로그** 확인
2. **브라우저 콘솔** (F12) 에러 메시지 확인
3. GitHub Issues에 문의

---

**🎉 축하합니다! 이제 랜딩페이지가 완전히 작동합니다!**
